# CodexMiroir - GitHub Copilot Instructions

## Project Overview

CodexMiroir is a voice-first, minimalistic task management system implementing the "Spiegelkodex" philosophy - a FIFO (First-In-First-Out) approach that enforces focus by showing only the current task prominently. The system operates in German and supports both professional and private task management with distinct visual themes.

### Core Philosophy
- **Focus-enforcing**: Only current task is prominently displayed
- **FIFO principle**: Strict first-in-first-out task ordering, no manual reordering
- **Voice-first**: Primary interaction through German voice commands
- **Dual-mode**: Professional (dark theme) and Private (light theme) separation
- **Minimalistic**: No complex animations, drag-and-drop, or overwhelming features

## Architecture

### Tech Stack
- **Frontend**: React 18 + TypeScript + Tailwind CSS + Vite
- **Backend**: Azure Functions (Node.js 18+) + Azure Blob Storage
- **AI Integration**: OpenAI GPT-4 for German voice command processing
- **Voice**: Web Speech API with fallback to text input
- **Storage**: Markdown files with YAML frontmatter in Azure Blob Storage

### Project Structure
```
/
├── client/                    # React frontend
│   ├── src/
│   │   ├── components/       # Reusable UI components
│   │   ├── lib/             # API services and utilities
│   │   └── pages/           # Page components
├── codex-miroir-fn/         # Azure Functions backend
├── shared/                  # Shared TypeScript types
├── server/                  # Legacy Express server (being phased out)
├── documentation/           # Complete project documentation
└── plans/                   # Planning and concept documents
```

## Development Guidelines

### Language and Localization
- **Primary Language**: German (de-DE) for UI, voice commands, and responses
- **Date Format**: Always use European format `dd.mm.yyyy [HH:MM]`
- **Voice Commands**: Natural German language processing with fallbacks
- **Code Comments**: English for technical documentation, German for user-facing content

### TypeScript Standards
- Use strict TypeScript configuration
- Define interfaces for API requests/responses in service layers
- Prefer type definitions over `any`
- Use Zod for runtime validation where applicable
- **Note**: `/shared/schema.ts` contains legacy PostgreSQL schema - current implementation uses Markdown files

### React/Frontend Guidelines
- Use functional components with hooks
- Implement proper error boundaries and loading states
- Follow Tailwind CSS utility-first approach
- Use shadcn/ui components for consistency
- Implement responsive design with mobile-first approach
- Ensure accessibility (ARIA labels, keyboard navigation)

### Voice Integration
- **Supported Commands**:
  - "Erstelle Aufgabe: [Titel]" - Create new task
  - "Aktuelle Aufgabe abschließen" - Complete current task  
  - "Aufgabe verschieben" - Push task to end
  - "Status anzeigen" - Show current status
- Use Web Speech API with graceful degradation
- Provide visual feedback for voice recognition states
- Implement pattern matching fallbacks when AI is unavailable

### Azure Functions Backend
- Single function with multiple actions via query parameter (`?action=...`)
- **Endpoints**:
  - `createTask` - Create new task with Markdown file and current.md entry
  - `completeTask` - Mark task complete, move to archive.md
  - `pushToEnd` - Move task to end of queue (when not workable)
  - `report` - Get statistics for a week/list combination
  - `when` - Find position of specific task in queue
  - `processCommand` - Process German voice commands with AI/fallback
  - `decomposeTask` - Break large tasks into 3.5h chunks using AI
  - `getCurrentTask` - Get voice-optimized current task information
- Use Azure Blob Storage for persistent data as Markdown files
- Implement proper error handling and logging
- Use API key authentication via `x-api-key` header
- Follow serverless best practices (stateless, idempotent)

### Data Management
- **Storage Format**: Markdown files with YAML frontmatter
- **Task Structure**: Each task is a separate `.md` file
  ```markdown
  ---
  id: T-0123
  list: pro              # 'pro' | 'priv' 
  title: "API Spec"
  status: geplant        # geplant | aktiv | abgeschlossen
  created_at: 23.09.2025 09:12
  scheduled_slot: 2025-W39-Tue-AM
  duration_slots: 1
  deadline: 30.09.2025 16:00
  project: ""
  azure_devops: ""
  requester: ""
  category_pro: programmierung   # meeting | programmierung
  category_priv: ""              # haushalt | projekt
  ---
  ## Notiz
  Task details...
  
  ## Verlauf
  - 23.09.2025 09:15 → geplant in `2025-W39-Tue-AM`
  ```
- **Organization**: Files organized by year and date (`/tasks/YYYY/YYYY-MM-DD--ID-slug.md`)
- **Current Tasks**: Tracked in `current.md` with weekly tables
- **Completed Tasks**: Archived in `archive.md` with completion data

### Time Slot System
- **Professional Mode**: Monday-Friday, 2 slots/day (9-12:30, 13:30-17:00)
- **Private Mode**: Monday-Friday evenings + weekends
- **Slot Duration**: Exactly 3.5 hours per slot
- **Slot IDs**: Format `YYYY-Www-DOW-AM/PM` (ISO week format)

## Coding Patterns

### API Service Layer
- Centralize API calls in `/client/src/lib/voice-codex-api.ts`
- Use proper TypeScript interfaces for request/response
- Implement retry logic and error handling
- Use React Query for caching and state management

### Component Structure
```tsx
// Example component pattern
interface ComponentProps {
  // Props interface
}

export function Component({ prop }: ComponentProps) {
  // Component logic
  return (
    <div className="proper-tailwind-classes">
      {/* Component JSX */}
    </div>
  );
}
```

### Voice Command Processing
- Primary processing via OpenAI GPT-4 API
- Fallback to regex pattern matching
- Response format includes intent, confidence, and parameters
- Support for context-aware processing

### Error Handling
- Graceful degradation when AI services are unavailable
- User-friendly German error messages
- Proper logging for debugging
- Fallback mechanisms for all critical functionality

## File Naming Conventions

### Tasks
- Format: `YYYY-MM-DD--<id>-<slug>.md`
- Example: `2025-09-23--T-0123-api-spec.md`

### Components
- PascalCase for React components: `VoiceTaskManager.tsx`
- kebab-case for utility files: `voice-codex-api.ts`

### Azure Functions
- Single `index.js` file with multiple exported functions
- Clear function naming: `createTask`, `completeTask`, `processCommand`

## Testing Considerations
- Test voice command recognition with German phrases
- Validate time slot calculations
- Test offline/fallback functionality
- Verify proper Markdown file generation
- Test dual-mode theme switching

## Environment Variables
```bash
# Azure Functions
AZURE_BLOB_CONN=<connection-string>
BLOB_CONTAINER=codex-miroir
API_KEY=<secure-api-key>
OPENAI_API_KEY=<openai-key> # Optional, has fallback

# Frontend
VITE_AZURE_FUNCTION_URL=<function-url>
VITE_API_KEY=<api-key>
```

## Performance Considerations
- API responses should be < 200ms for CRUD operations
- Voice recognition should process within 2 seconds
- UI updates should be < 100ms
- Implement proper loading states and optimistic updates
- Use React.memo for expensive components
- Minimize bundle size with proper tree shaking

## AI Integration Guidelines
- Use temperature 0.3 for consistent command parsing
- Implement proper prompt engineering for German context
- Always provide fallback for AI failures
- Cache common responses to reduce API calls
- Respect OpenAI rate limits and usage policies

## Accessibility Requirements
- Support keyboard navigation throughout
- Provide proper ARIA labels and descriptions
- Support screen readers
- Ensure sufficient color contrast
- Provide alternative text input when voice isn't available

## Documentation Standards
- Update relevant documentation when changing functionality
- Include German examples for voice commands
- Document API endpoints with request/response examples
- Maintain deployment guides for Azure services
- Keep README files current with setup instructions

## Migration Notes
The project has been migrated from a Next.js/Express/PostgreSQL stack to the current Azure Functions architecture. Legacy code exists in:
- `/server/` directory (old Express server) - should not be modified
- `/shared/schema.ts` (old PostgreSQL schema) - kept for reference but not used
- Some components may reference old API structures

Focus development on:
- Azure Functions backend (`/codex-miroir-fn/`)
- React frontend (`/client/src/`)
- Voice-first user experience

When working on this project, prioritize the voice-first experience, maintain the focus-enforcing FIFO principle, and ensure all user-facing content supports German language properly.