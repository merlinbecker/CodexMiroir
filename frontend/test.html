<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodexMiroir Test</title>
    <style>
        /* Inline test styles */
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .current-task { background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .input-buttons { display: flex; gap: 20px; justify-content: center; margin-bottom: 30px; }
        .voice-btn, .text-btn { background: #8b5cf6; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; }
        .voice-btn.listening { background: #ef4444; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%; }
        .daily-tasks { background: #f5f5f5; padding: 20px; border-radius: 8px; }
        .nav-arrows { display: flex; justify-content: space-between; margin: 20px 0; }
        .nav-btn { background: #6b7280; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; }
    </style>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body x-data="testAppData()" x-init="init()">
    <h1>CodexMiroir - Frontend Test</h1>
    
    <!-- View 1: Main View -->
    <div x-show="currentView === 'main'">
        <!-- Current Task -->
        <div class="current-task">
            <h2>Aktuelle Aufgabe</h2>
            <div x-show="currentTask">
                <h3 x-text="currentTask?.title || 'Keine aktuelle Aufgabe'"></h3>
                <p x-text="currentTask?.description || ''"></p>
                <small x-text="formatDate(new Date())"></small>
            </div>
            <div x-show="!currentTask">
                <p>Keine Aufgabe f√ºr den aktuellen Zeitpunkt</p>
            </div>
        </div>

        <!-- Input Buttons -->
        <div class="input-buttons">
            <button class="voice-btn" 
                    :class="{ 'listening': isListening }"
                    @click="openVoiceModal()">
                <span>üé§</span>
                <span x-text="isListening ? ' H√∂re zu...' : ' Spracheingabe'"></span>
            </button>
            
            <button class="text-btn" @click="openTextModal()">
                <span>‚úçÔ∏è</span>
                <span> Texteingabe</span>
            </button>
        </div>

        <!-- Daily Tasks Container -->
        <div class="daily-tasks">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 x-text="formatDayHeader(currentDate)"></h3>
                <small x-text="'KW ' + getWeekNumber(currentDate)"></small>
            </div>
            
            <!-- Navigation Arrows -->
            <div class="nav-arrows">
                <button class="nav-btn" @click="scrollToPreviousDay()">‚Üê</button>
                <button class="nav-btn" @click="scrollToNextDay()">‚Üí</button>
            </div>

            <!-- Tasks List -->
            <div>
                <template x-for="task in todaysTasks" :key="task.id">
                    <div style="background: white; padding: 15px; margin-bottom: 10px; border-radius: 6px;">
                        <h4 x-text="task.title" style="margin: 0 0 10px 0;"></h4>
                        <p x-text="task.description" style="margin: 0 0 5px 0; color: #666;"></p>
                        <small x-text="task.deadline" style="color: #999;"></small>
                    </div>
                </template>
                <div x-show="todaysTasks.length === 0">
                    <p>Keine Aufgaben f√ºr heute</p>
                </div>
            </div>
        </div>

        <!-- Settings Button -->
        <button @click="openSettingsModal()" style="position: fixed; bottom: 20px; right: 20px; background: #8b5cf6; color: white; border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 20px; cursor: pointer;">
            ‚öôÔ∏è
        </button>
    </div>

    <!-- View 2: Voice Recording Modal -->
    <div class="modal" :class="{ 'show': currentView === 'voice' }">
        <div class="modal-content">
            <div style="text-align: center;">
                <div style="width: 100px; height: 100px; border-radius: 50%; background: #ef4444; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 40px; animation: pulse 1s infinite;">
                    üé§
                </div>
                <h3>Sprechen Sie jetzt...</h3>
                <p x-text="'Verbleibende Zeit: ' + recordingTimeLeft + 's'"></p>
                <button @click="stopRecording()" style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Beenden</button>
            </div>
        </div>
    </div>

    <!-- View 3: Text Input Modal -->
    <div class="modal" :class="{ 'show': currentView === 'text' }">
        <div class="modal-content">
            <h3>Neue Aufgabe erstellen</h3>
            <form @submit.prevent="saveTask()">
                <div style="margin-bottom: 15px;">
                    <label>Titel</label><br>
                    <input type="text" x-model="newTask.title" required style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>Notiz</label><br>
                    <textarea x-model="newTask.description" rows="3" style="width: 100%; padding: 8px; margin-top: 5px;"></textarea>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>Deadline</label><br>
                    <input type="date" x-model="newTask.deadline" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>Projekt</label><br>
                    <input type="text" x-model="newTask.project" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>Tags</label><br>
                    <input type="text" x-model="newTask.tags" placeholder="Tag1, Tag2, Tag3" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                
                <div>
                    <button type="submit" style="background: #8b5cf6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-right: 10px;">Speichern</button>
                    <button type="button" @click="closeModal()" style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Abbrechen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View 4: Settings Modal -->
    <div class="modal" :class="{ 'show': currentView === 'settings' }">
        <div class="modal-content">
            <h3>Einstellungen</h3>
            <div>
                <h4>Aktuelles Token</h4>
                <div style="background: #f3f4f6; border: 1px solid #ccc; border-radius: 4px; padding: 15px; font-family: monospace; word-break: break-all; margin: 15px 0;" x-text="currentToken || 'Kein Token gesetzt'"></div>
                <button @click="copyToken()" style="background: #8b5cf6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-right: 10px;">Token kopieren</button>
            </div>
            <button @click="closeModal()" style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Schlie√üen</button>
        </div>
    </div>

    <!-- Alpine.js App Logic -->
    <script>
        function testAppData() {
            return {
                currentView: 'main',
                currentTask: { title: 'Test Aufgabe', description: 'Eine Beispielaufgabe f√ºr heute' },
                tasks: [
                    { id: 1, title: 'Frontend refactoring', description: 'Code cleanup', deadline: new Date().toISOString().split('T')[0], status: 'pending' },
                    { id: 2, title: 'API integration', description: 'Connect to backend', deadline: new Date().toISOString().split('T')[0], status: 'pending' }
                ],
                todaysTasks: [],
                currentDate: new Date(),
                currentToken: 'test-token-123-abc',
                isListening: false,
                recordingTimeLeft: 10,
                recordingTimer: null,
                newTask: { title: '', description: '', deadline: '', project: '', tags: '' },

                init() {
                    this.updateTodaysTasks();
                    console.log('CodexMiroir Test App initialized');
                },

                formatDate(date) {
                    return date.toLocaleDateString('de-DE', { 
                        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
                        hour: '2-digit', minute: '2-digit'
                    });
                },

                formatDayHeader(date) {
                    return date.toLocaleDateString('de-DE', { 
                        weekday: 'long', day: 'numeric', month: 'long'
                    });
                },

                getWeekNumber(date) {
                    const target = new Date(date.valueOf());
                    const dayNumber = (date.getUTCDay() + 6) % 7;
                    target.setUTCDate(target.getUTCDate() - dayNumber + 3);
                    const firstThursday = target.valueOf();
                    target.setUTCMonth(0, 1);
                    if (target.getUTCDay() !== 4) {
                        target.setUTCMonth(0, 1 + ((4 - target.getUTCDay()) + 7) % 7);
                    }
                    return 1 + Math.ceil((firstThursday - target) / 604800000);
                },

                openVoiceModal() {
                    this.currentView = 'voice';
                    this.startVoiceRecording();
                },

                openTextModal() {
                    this.currentView = 'text';
                    this.resetNewTask();
                },

                openSettingsModal() {
                    this.currentView = 'settings';
                },

                closeModal() {
                    this.currentView = 'main';
                    this.stopRecording();
                },

                startVoiceRecording() {
                    this.isListening = true;
                    this.recordingTimeLeft = 10;
                    this.recordingTimer = setInterval(() => {
                        this.recordingTimeLeft--;
                        if (this.recordingTimeLeft <= 0) {
                            this.stopRecording();
                        }
                    }, 1000);
                    console.log('Voice recording started');
                },

                stopRecording() {
                    this.isListening = false;
                    if (this.recordingTimer) {
                        clearInterval(this.recordingTimer);
                        this.recordingTimer = null;
                    }
                    this.currentView = 'main';
                    console.log('Voice recording stopped');
                },

                scrollToPreviousDay() {
                    this.currentDate.setDate(this.currentDate.getDate() - 1);
                    this.updateTodaysTasks();
                    console.log('Scrolled to previous day:', this.currentDate.toDateString());
                },

                scrollToNextDay() {
                    this.currentDate.setDate(this.currentDate.getDate() + 1);
                    this.updateTodaysTasks();
                    console.log('Scrolled to next day:', this.currentDate.toDateString());
                },

                resetNewTask() {
                    this.newTask = { title: '', description: '', deadline: '', project: '', tags: '' };
                },

                saveTask() {
                    const task = {
                        id: Date.now(),
                        ...this.newTask,
                        created: new Date().toISOString(),
                        status: 'pending'
                    };
                    this.tasks.push(task);
                    this.updateTodaysTasks();
                    this.closeModal();
                    alert('Aufgabe gespeichert: ' + task.title);
                    console.log('Task saved:', task);
                },

                updateTodaysTasks() {
                    const today = this.currentDate.toDateString();
                    this.todaysTasks = this.tasks.filter(task => 
                        new Date(task.deadline).toDateString() === today
                    );
                },

                copyToken() {
                    if (this.currentToken) {
                        if (navigator.clipboard) {
                            navigator.clipboard.writeText(this.currentToken);
                            alert('Token kopiert!');
                        } else {
                            console.log('Token to copy:', this.currentToken);
                            alert('Token: ' + this.currentToken);
                        }
                    }
                }
            };
        }
    </script>
</body>
</html>